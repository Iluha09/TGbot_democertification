import random
import telebot
from telebot import types
from telebot.handler_backends import State, StatesGroup
from telebot.storage import StateMemoryStorage

state_storage = StateMemoryStorage()
bot = telebot.TeleBot("7474130496:AAHqjoSWNrcK_HpPjpiWOeNDMhkdtNicPD0", state_storage=state_storage)

physics_tasks_v1 = [
    {
        "question": "Задание 1: Тело брошено вертикально вверх с начальной скоростью 20 м/с. С какой высоты оно было брошено, если через 2 с после броска его скорость стала 10 м/с, направленной вверх? Сопротивлением воздуха пренебречь.",
        "answer": "0",
        "solution": "Уравнение скорости: v = v₀ - g*t. Подставляем: 10 = 20 - 10*2 → 10 = 20 - 20 → 10 = 0? Нестыковка. Верный ход: найдем перемещение за 2 с. y = v₀*t - (g*t²)/2 = 20*2 - (10*4)/2 = 40 - 20 = 20 м. Тело поднялось на 20 м от точки бросания. Ответ: 0 м (брошено с земли, и через 2 с оно на высоте 20 м)."
    },
    {
        "question": "Задание 2: Автомобиль массой 1 т движется по выпуклому мосту с радиусом кривизны 100 м. Какова сила давления автомобиля на мост в верхней точке, если его скорость там равна 72 км/ч?",
        "answer": "6000",
        "solution": "m = 1000 кг, R = 100 м, v = 72 / 3.6 = 20 м/с. В верхней точке: mg - N = m*v²/R. N = m*g - m*v²/R = m*(g - v²/R) = 1000*(10 - 400/100) = 1000*(10 - 4) = 6000 Н = 6 кН. Сила давления равна силе реакции опоры N по 3-му закону Ньютона."
    },
    {
        "question": "Задание 3: Найдите равнодействующую трех сил: F₁=3 Н (вправо), F₂=4 Н (вверх), F₃=5 Н (направлена под углом 37° к горизонту влево вверх). cos37°≈0.8, sin37°≈0.6.",
        "answer": "7.07",
        "solution": "Спроецируем все силы на оси: Ox: Fₓ = 3 - 5*0.8 = 3 - 4 = -1 Н. Oy: Fᵧ = 4 + 5*0.6 = 4 + 3 = 7 Н. Модуль равнодействующей: R = √((-1)² + 7²) = √(1+49) = √50 ≈ 7.07 Н"
    },
    {
        "question": "Задание 4: Идеальный газ перешел из состояния 1 в состояние 2 так, что его давление увеличилось в 2 раза, а объем уменьшился в 2 раза. Как изменилась абсолютная температура газа?",
        "answer": "не изменилась",
        "solution": "Уравнение Клапейрона: P₁V₁/T₁ = P₂V₂/T₂. P₂ = 2P₁, V₂ = V₁/2. (P₁V₁)/T₁ = (2P₁ * V₁/2) / T₂ → (P₁V₁)/T₁ = (P₁V₁)/T₂. Следовательно, T₁ = T₂. Температура не изменилась."
    },
    {
        "question": "Задание 5: Какое количество теплоты необходимо для плавления 2 кг льда, взятого при температуре -10°C? Удельная теплоемкость льда 2100 Дж/(кг·°C), удельная теплота плавления 330 кДж/кг.",
        "answer": "702000",
        "solution": "Нагреваем лед до 0°C: Q₁ = c*m*ΔT = 2100 * 2 * 10 = 42000 Дж. Плавим лед: Q₂ = λ*m = 330000 * 2 = 660000 Дж. Общее: Q = Q₁ + Q₂ = 42000 + 660000 = 702000 Дж = 702 кДж."
    },
    {
        "question": "Задание 6: Электрическая цепь состоит из источника тока с ЭДС 12 В и внутренним сопротивлением 1 Ом и двух резисторов: R₁=2 Ом, R₂=3 Ом, соединенных параллельно. Найдите силу тока в цепи.",
        "answer": "5.45",
        "solution": "Сопротивление параллельного участка: 1/R = 1/2 + 1/3 = 5/6 → R = 6/5 = 1.2 Ом. Общее сопротивление цепи: R_общ = R + r = 1.2 + 1 = 2.2 Ом. Сила тока по закону Ома для полной цепи: I = E / R_общ = 12 / 2.2 ≈ 5.45 А"
    },
    {
        "question": "Задание 7: Луч света падает из воздуха на поверхность жидкости под углом 30°. Определите показатель преломления жидкости, если угол преломления равен 22°. sin30°=0.5, sin22°≈0.375.",
        "answer": "1.33",
        "solution": "Закон Снеллиуса: n₁*sinα = n₂*sinβ. 1 * 0.5 = n_ж * 0.375. n_ж = 0.5 / 0.375 ≈ 1.33"
    },
    {
        "question": "Задание 8: Какова энергия фотона, соответствующего световой волне с длиной волны 500 нм? Постоянная Планка h=6.63·10⁻³⁴ Дж·с, скорость света c=3·10⁸ м/с.",
        "answer": "3.978e-19",
        "solution": "Формула энергии фотона: E = h*c/λ. λ = 500 нм = 5*10⁻⁷ м. E = (6.63*10⁻³⁴ * 3*10⁸) / (5*10⁻⁷) = (19.89*10⁻²⁶) / (5*10⁻⁷) = 3.978*10⁻¹⁹ Дж"
    },
    {
        "question": "Задание 9: Ядро атома претерпело α-распад, а затем два β-распада. Как изменились массовое и зарядовое числа ядра?",
        "answer": "-4,0",
        "solution": "α-распад: Z уменьшается на 2, A уменьшается на 4. β-распад: Z увеличивается на 1, A не меняется. После двух β-распадов: общее изменение Z: (-2) + (+1) + (+1) = 0. Общее изменение A: -4. Массовое число уменьшилось на 4, зарядовое число не изменилось."
    },
    {
        "question": "Задание 10: КПД теплового двигателя 30%. Чему равна работа, совершенная двигателем, если холодильнику передано количество теплоты 140 Дж?",
        "answer": "60",
        "solution": "Формула КПД: η = (Q_нагр - Q_хол) / Q_нагр = A / Q_нагр. A = Q_нагр - Q_хол. Из формулы КПД: 0.3 = A / Q_нагр → Q_нагр = A / 0.3. Подставляем: A = (A/0.3) - 140. A - A/0.3 = -140 → A(1 - 10/3) = -140 → A*(-7/3) = -140. A = (140 * 3) / 7 = 60 Дж"
    }
]

# Версия 2 заданий (второй вариант) - ФИЗИКА
physics_tasks_v2 = [
    {
        "question": "Задание 1: Тело брошено вертикально вверх с начальной скоростью 30 м/с. С какой высоты оно было брошено, если через 3 с после броска его скорость стала 5 м/с, направленной вверх? Сопротивлением воздуха пренебречь.",
        "answer": "0",
        "solution": "Уравнение скорости: v = v₀ - g*t. Подставляем: 5 = 30 - 10*3 → 5 = 30 - 30 → 5 = 0? Нестыковка. Верный ход: найдем перемещение за 3 с. y = v₀*t - (g*t²)/2 = 30*3 - (10*9)/2 = 90 - 45 = 45 м. Тело поднялось на 45 м от точки бросания. Ответ: 0 м (брошено с земли, и через 3 с оно на высоте 45 м)."
    },
    {
        "question": "Задание 2: Автомобиль массой 1.2 т движется по выпуклому мосту с радиусом кривизны 80 м. Какова сила давления автомобиля на мост в верхней точке, если его скорость там равна 54 км/ч?",
        "answer": "8625",
        "solution": "m = 1200 кг, R = 80 м, v = 54 / 3.6 = 15 м/с. В верхней точке: mg - N = m*v²/R. N = m*g - m*v²/R = m*(g - v²/R) = 1200*(10 - 225/80) = 1200*(10 - 2.8125) = 1200*7.1875 = 8625 Н = 8.625 кН. Сила давления равна силе реакции опоры N по 3-му закону Ньютона."
    },
    {
        "question": "Задание 3: Найдите равнодействующую трех сил: F₁=5 Н (вправо), F₂=12 Н (вверх), F₃=13 Н (направлена под углом 37° к горизонту влево вверх). cos37°≈0.8, sin37°≈0.6.",
        "answer": "20.52",
        "solution": "Спроецируем все силы на оси: Ox: Fₓ = 5 - 13*0.8 = 5 - 10.4 = -5.4 Н. Oy: Fᵧ = 12 + 13*0.6 = 12 + 7.8 = 19.8 Н. Модуль равнодействующей: R = √((-5.4)² + 19.8²) = √(29.16 + 392.04) = √421.2 ≈ 20.52 Н"
    },
    {
        "question": "Задание 4: Идеальный газ перешел из состояния 1 в состояние 2 так, что его давление увеличилось в 3 раза, а объем уменьшился в 2 раза. Как изменилась абсолютная температура газа?",
        "answer": "увеличилась в 1.5 раза",
        "solution": "Уравнение Клапейрона: P₁V₁/T₁ = P₂V₂/T₂. P₂ = 3P₁, V₂ = V₁/2. (P₁V₁)/T₁ = (3P₁ * V₁/2) / T₂ → (P₁V₁)/T₁ = (3P₁V₁)/(2T₂). Сократим P₁V₁: 1/T₁ = 3/(2T₂) → 2T₂ = 3T₁ → T₂ = 1.5 T₁. Температура увеличилась в 1.5 раза."
    },
    {
        "question": "Задание 5: Какое количество теплоты необходимо для плавления 3 кг льда, взятого при температуре -15°C? Удельная теплоемкость льда 2100 Дж/(кг·°C), удельная теплота плавления 330 кДж/кг.",
        "answer": "1084500",
        "solution": "Нагреваем лед до 0°C: Q₁ = c*m*ΔT = 2100 * 3 * 15 = 94500 Дж. Плавим лед: Q₂ = λ*m = 330000 * 3 = 990000 Дж. Общее: Q = Q₁ + Q₂ = 94500 + 990000 = 1084500 Дж = 1084.5 кДж."
    },
    {
        "question": "Задание 6: Электрическая цепь состоит из источника тока с ЭДС 15 В и внутренним сопротивлением 2 Ом и двух резисторов: R₁=4 Ом, R₂=6 Ом, соединенных параллельно. Найдите силу тока в цепи.",
        "answer": "3.41",
        "solution": "Сопротивление параллельного участка: 1/R = 1/4 + 1/6 = 5/12 → R = 12/5 = 2.4 Ом. Общее сопротивление цепи: R_общ = R + r = 2.4 + 2 = 4.4 Ом. Сила тока по закону Ома для полной цепи: I = E / R_общ = 15 / 4.4 ≈ 3.41 А"
    },
    {
        "question": "Задание 7: Луч света падает из воздуха на поверхность жидкости под углом 45°. Определите показатель преломления жидкости, если угол преломления равен 30°. sin45°≈0.707, sin30°=0.5.",
        "answer": "1.414",
        "solution": "Закон Снеллиуса: n₁*sinα = n₂*sinβ. 1 * 0.707 = n_ж * 0.5. n_ж = 0.707 / 0.5 ≈ 1.414"
    },
    {
        "question": "Задание 8: Какова энергия фотона, соответствующего световой волне с длиной волны 600 нм? Постоянная Планка h=6.63·10⁻³⁴ Дж·с, скорость света c=3·10⁸ м/с.",
        "answer": "3.315e-19",
        "solution": "Формула энергии фотона: E = h*c/λ. λ = 600 нм = 6*10⁻⁷ м. E = (6.63*10⁻³⁴ * 3*10⁸) / (6*10⁻⁷) = (19.89*10⁻²⁶) / (6*10⁻⁷) ≈ 3.315*10⁻¹⁹ Дж"
    },
    {
        "question": "Задание 9: Ядро атома претерпело α-распад, а затем два β-распада. Как изменились массовое и зарядовое числа ядра?",
        "answer": "-4,0",
        "solution": "α-распад: Z уменьшается на 2, A уменьшается на 4. β-распад: Z увеличивается на 1, A не меняется. После двух β-распадов: общее изменение Z: (-2) + (+1) + (+1) = 0. Общее изменение A: -4. Массовое число уменьшилось на 4, зарядовое число не изменилось."
    },
    {
        "question": "Задание 10: КПД теплового двигателя 25%. Чему равна работа, совершенная двигателем, если холодильнику передано количество теплоты 150 Дж?",
        "answer": "50",
        "solution": "Формула КПД: η = (Q_нагр - Q_хол) / Q_нагр = A / Q_нагр. A = Q_нагр - Q_хол. Из формулы КПД: 0.25 = A / Q_нагр → Q_нагр = A / 0.25 = 4A. Подставляем в уравнение для работы: A = 4A - 150. A - 4A = -150 → -3A = -150 → A = 50 Дж"
    }
]

# Версия 1 заданий (первый вариант) - МАТЕМАТИКА
math_tasks_v1 = [
    {
        "question": "Задание 1: В равнобедренном треугольнике ABC с основанием AC боковая сторона AB равна 13, а высота, проведенная к основанию, равна 12. Найдите длину основания AC.",
        "answer": "10",
        "solution": "Высота в равнобедренном треугольнике является и медианой. Рассмотрим прямоугольный треугольник ABH (H - середина AC). По теореме Пифагора: AH = √(AB² - BH²) = √(169 - 144) = √25 = 5. AC = 2 * AH = 2 * 5 = 10."
    },
    {
        "question": "Задание 2: Решите уравнение: √(3x - 2) = x - 2",
        "answer": "6",
        "solution": "ОДЗ: 3x - 2 ≥ 0 → x ≥ 2/3 и x - 2 ≥ 0 → x ≥ 2. Итак, x ≥ 2. Возводим в квадрат: 3x - 2 = (x-2)². 3x - 2 = x² - 4x + 4. x² - 7x + 6 = 0. Корни: x₁=1, x₂=6. Учитывая ОДЗ (x ≥ 2), корень x₁=1 не подходит."
    },
    {
        "question": "Задание 3: Вычислите: sin(15°) * cos(15°)",
        "answer": "0.25",
        "solution": "Используем формулу синуса двойного угла: sin(2α) = 2sinαcosα. sin(15°)cos(15°) = (1/2) * sin(30°) = (1/2) * (1/2) = 1/4 = 0.25"
    },
    {
        "question": "Задание 4: Найдите производную функции: f(x) = (x² + 3x - 1) * e^x",
        "answer": "e^x(x^2+5x+2)",
        "solution": "Правило произведения: (u*v)' = u'v + uv'. u = x² + 3x - 1, u' = 2x + 3. v = e^x, v' = e^x. f'(x) = (2x+3)e^x + (x²+3x-1)e^x = e^x(2x+3 + x²+3x-1) = e^x(x² + 5x + 2)"
    },
    {
        "question": "Задание 5: Решите неравенство: log₂(x - 1) < 3",
        "answer": "(1;9)",
        "solution": "ОДЗ: x - 1 > 0 → x > 1. log₂(x-1) < 3. x - 1 < 2³. x - 1 < 8. x < 9. С учетом ОДЗ: 1 < x < 9"
    },
    {
        "question": "Задание 6: В правильной четырехугольной пирамиде сторона основания равна 6, а боковое ребро равно 5. Найдите высоту пирамиды.",
        "answer": "√7",
        "solution": "В основании квадрат. Диагональ квадрата: d = a√2 = 6√2. Половина диагонали: d/2 = 3√2. Рассмотрим прямоугольный треугольник: высота пирамиды H, половина диагонали основания, боковое ребро. По теореме Пифагора: H = √(l² - (d/2)²) = √(25 - 18) = √7"
    },
    {
        "question": "Задание 7: Решите уравнение: 2cos²x + 3sinx = 0",
        "answer": "-(-1)^n*π/6+πn",
        "solution": "Заменим cos²x = 1 - sin²x: 2(1 - sin²x) + 3sinx = 0. 2 - 2sin²x + 3sinx = 0. -2sin²x + 3sinx + 2 = 0 → Умножим на -1: 2sin²x - 3sinx - 2 = 0. Пусть t = sinx, тогда 2t² - 3t - 2 = 0. D = 9 + 16 = 25. Корни: t₁ = (3+5)/4 = 2, t₂ = (3-5)/4 = -1/2. sinx = 2 - решений нет. sinx = -1/2 → x = (-1)^n * (-π/6) + πn = -(-1)^n * π/6 + πn"
    },
    {
        "question": "Задание 8: Найдите площадь фигуры, ограниченной линиями y = x² и y = 2x.",
        "answer": "4/3",
        "solution": "Найдем точки пересечения: x² = 2x → x(x-2)=0 → x₁=0, x₂=2. На отрезке [0;2] прямая y=2x выше параболы y=x². Площадь: S = ∫₀² (2x - x²) dx = (x² - x³/3)|₀² = (4 - 8/3) - 0 = 4/3"
    },
    {
        "question": "Задание 9: В случайном эксперименте бросают две игральные кости. Найдите вероятность того, что сумма выпавших очков равна 5.",
        "answer": "1/9",
        "solution": "Всего исходов: 6 * 6 = 36. Благоприятные исходы (сумма=5): (1,4), (2,3), (3,2), (4,1) → 4 исхода. Вероятность: P = 4/36 = 1/9"
    },
    {
        "question": "Задание 10: Решите систему уравнений: x + y = 5, x² + y² = 13",
        "answer": "(2,3);(3,2)",
        "solution": "Из первого уравнения: y = 5 - x. Подставим во второе: x² + (5-x)² = 13. x² + 25 - 10x + x² = 13. 2x² - 10x + 12 = 0 → Делим на 2: x² - 5x + 6 = 0. Корни: x₁=2, x₂=3. Находим y: y₁=3, y₂=2"
    }
]

# Версия 2 заданий (второй вариант) - МАТЕМАТИКА
math_tasks_v2 = [
    {
        "question": "Задание 1: В равнобедренном треугольнике ABC с основанием AC боковая сторона AB равна 17, а высота, проведенная к основанию, равна 15. Найдите длину основания AC.",
        "answer": "16",
        "solution": "Высота в равнобедренном треугольнике является и медианой. Рассмотрим прямоугольный треугольник ABH (H - середина AC). По теореме Пифагора: AH = √(AB² - BH²) = √(289 - 225) = √64 = 8. AC = 2 * AH = 2 * 8 = 16."
    },
    {
        "question": "Задание 2: Решите уравнение: √(4x - 3) = x - 3",
        "answer": "5+√13",
        "solution": "ОДЗ: 4x - 3 ≥ 0 → x ≥ 3/4 и x - 3 ≥ 0 → x ≥ 3. Итак, x ≥ 3. Возводим в квадрат: 4x - 3 = (x-3)². 4x - 3 = x² - 6x + 9. x² - 10x + 12 = 0. Дискриминант: D = 100 - 48 = 52. Корни: x = (10 ± √52)/2 = 5 ± √13. Учитывая ОДЗ (x ≥ 3), 5 - √13 ≈ 1.39 < 3. Подходит только x = 5 + √13."
    },
    {
        "question": "Задание 3: Вычислите: sin(22.5°) * cos(22.5°)",
        "answer": "√2/4",
        "solution": "Используем формулу синуса двойного угла: sin(2α) = 2sinαcosα. sin(22.5°)cos(22.5°) = (1/2) * sin(45°) = (1/2) * (√2/2) = √2/4 ≈ 0.3536"
    },
    {
        "question": "Задание 4: Найдите производную функции: f(x) = (x² - 4x + 3) * e^x",
        "answer": "e^x(x^2-2x-1)",
        "solution": "Правило произведения: (u*v)' = u'v + uv'. u = x² - 4x + 3, u' = 2x - 4. v = e^x, v' = e^x. f'(x) = (2x-4)e^x + (x²-4x+3)e^x = e^x(2x-4 + x²-4x+3) = e^x(x² - 2x - 1)"
    },
    {
        "question": "Задание 5: Решите неравенство: log₃(x + 2) < 2",
        "answer": "(-2;7)",
        "solution": "ОДЗ: x + 2 > 0 → x > -2. log₃(x+2) < 2. x + 2 < 3². x + 2 < 9. x < 7. С учетом ОДЗ: -2 < x < 7"
    },
    {
        "question": "Задание 6: В правильной четырехугольной пирамиде сторона основания равна 8, а боковое ребро равно 10. Найдите высоту пирамиды.",
        "answer": "2√17",
        "solution": "В основании квадрат. Диагональ квадрата: d = a√2 = 8√2. Половина диагонали: d/2 = 4√2. Рассмотрим прямоугольный треугольник: высота пирамиды H, половина диагонали основания, боковое ребро. По теореме Пифагора: H = √(l² - (d/2)²) = √(100 - 32) = √68 = 2√17"
    },
    {
        "question": "Задание 7: Решите уравнение: 3cos²x + 5sinx = 0",
        "answer": "(-1)^n*arcsin((5-√61)/6)+πn",
        "solution": "Заменим cos²x = 1 - sin²x: 3(1 - sin²x) + 5sinx = 0. 3 - 3sin²x + 5sinx = 0. -3sin²x + 5sinx + 3 = 0 → Умножим на -1: 3sin²x - 5sinx - 3 = 0. Пусть t = sinx, тогда 3t² - 5t - 3 = 0. D = 25 + 36 = 61. Корни: t₁ = (5+√61)/6 ≈ 2.135, t₂ = (5-√61)/6 ≈ -0.468. sinx = (5+√61)/6 > 1 - решений нет. sinx = (5-√61)/6 → x = (-1)^n * arcsin((5-√61)/6) + πn, n ∈ Z."
    },
    {
        "question": "Задание 8: Найдите площадь фигуры, ограниченной линиями y = x² и y = 3x.",
        "answer": "4.5",
        "solution": "Найдем точки пересечения: x² = 3x → x(x-3)=0 → x₁=0, x₂=3. На отрезке [0;3] прямая y=3x выше параболы y=x². Площадь: S = ∫₀³ (3x - x²) dx = (3x²/2 - x³/3)|₀³ = (27/2 - 27/3) - 0 = (13.5 - 9) = 4.5"
    },
    {
        "question": "Задание 9: В случайном эксперименте бросают две игральные кости. Найдите вероятность того, что сумма выпавших очков равна 7.",
        "answer": "1/6",
        "solution": "Всего исходов: 6 * 6 = 36. Благоприятные исходы (сумма=7): (1,6), (2,5), (3,4), (4,3), (5,2), (6,1) → 6 исходов. Вероятность: P = 6/36 = 1/6"
    },
    {
        "question": "Задание 10: Решите систему уравнений: x + y = 7, x² + y² = 25",
        "answer": "(3,4);(4,3)",
        "solution": "Из первого уравнения: y = 7 - x. Подставим во второе: x² + (7-x)² = 25. x² + 49 - 14x + x² = 25. 2x² - 14x + 24 = 0 → Делим на 2: x² - 7x + 12 = 0. Корни: x₁=3, x₂=4. Находим y: y₁=4, y₂=3"
    }
]

# Версия 1 заданий (первый вариант) - ИНФОРМАТИКА
informatics_tasks_v1 = [
    {
        "question": "Задание 1: Сколько единиц в двоичной записи числа 135?",
        "answer": "4",
        "solution": "Переведем 135 в двоичную систему: 135 / 2 = 67 (1), 67 / 2 = 33 (1), 33 / 2 = 16 (1), 16 / 2 = 8 (0), 8 / 2 = 4 (0), 4 / 2 = 2 (0), 2 / 2 = 1 (0), 1 / 2 = 0 (1). Записываем остатки снизу вверх: 10000111. Считаем единицы: их 4."
    },
    {
        "question": "Задание 2: На месте преступления были обнаружены четыре обрывка бумаги. Следствие установило, что на них записаны фрагменты одного IP-адреса. Определите IP-адрес. Обрывки: 19, 2.168, 21.19, 168",
        "answer": "192.168.21.19",
        "solution": "IP-адрес состоит из четырёх чисел (октетов), разделённых точками. Фрагмент 2.168 может быть началом адреса. Фрагмент 21.19 может быть концом. Единственный способ совместить их, используя все обрывки — это получить адрес 192.168.21.19."
    },
    {
        "question": "Задание 3: Напишите наименьшее целое число x, для которого истинно высказывание: НЕ (x < 12) И (x четное)",
        "answer": "12",
        "solution": "НЕ (x < 12) означает x ≥ 12. (x четное) означает, что x делится на 2. Наименьшее целое число, удовлетворяющее обоим условиям: 12."
    },
    {
        "question": "Задание 4: Алгоритм вычисления значения функции F(n), где n — натуральное число, задан следующими соотношениями: F(1) = 1; F(n) = F(n-1) + n, при n > 1. Чему равно значение функции F(5)?",
        "answer": "15",
        "solution": "Вычислим последовательно: F(1) = 1; F(2) = F(1) + 2 = 1 + 2 = 3; F(3) = F(2) + 3 = 3 + 3 = 6; F(4) = F(3) + 4 = 6 + 4 = 10; F(5) = F(4) + 5 = 10 + 5 = 15"
    },
    {
        "question": "Задание 5: Определите значение переменной «a» после выполнения фрагмента программы: a := 10; b := 5; b := a + b; a := b - a",
        "answer": "5",
        "solution": "a=10, b=5. b := 10 + 5 = 15. a := 15 - 10 = 5"
    },
    {
        "question": "Задание 6: Какое значение будет выведено на экран после выполнения этого фрагмента программы на языке Python?\n```python\ns = 0\nfor i in range(1, 6):\n    if i % 2 == 0:\n        s = s + i\nprint(s)\n```",
        "answer": "6",
        "solution": "Цикл перебирает числа i от 1 до 5 включительно (range(1,6)). Переменная s увеличивается на значение i, только если i чётное (i % 2 == 0). Чётные числа в диапазоне: 2 и 4. Вычисления: s = 0 + 2 = 2; s = 2 + 4 = 6. На экран выводится значение s, равное 6."
    },
    {
        "question": "Задание 7: Для кодирования некоторой последовательности, состоящей из букв А, Б, В, Г, Д, решили использовать неравномерный двоичный код, удовлетворяющий условию Фано. Для букв А, Б, В использовали соответственно кодовые слова 00, 01, 100. Укажите кратчайшее возможное кодовое слово для буквы Г, при котором код будет допускать однозначное декодирование.",
        "answer": "11",
        "solution": "Условие Фано: ни одно кодовое слово не является началом другого. У нас есть: А=00, Б=01, В=100. Кратчайшие возможные кодовые слова - из 1 бита: 0 и 1. Но 0 - начало А и Б, 1 - начало В. Не подходят. Двухбитные: 10 (начало В), 11 (не является началом ни одного из существующих). Подходит."
    },
    {
        "question": "Задание 8: Мощность алфавита равна 64. Сколько Кбайт памяти потребуется, чтобы сохранить 128 страниц текста, содержащего в среднем 256 символов на странице?",
        "answer": "24",
        "solution": "Мощность алфавита 64. Для кодирования 64 символов нужно: 2⁶=64 → i=6 бит на символ. Общее количество символов: 128 стр * 256 сим/стр = 32768 символов. Информационный объем: I = K * i = 32768 * 6 бит = 196608 бит. Переведем в байты: 196608 / 8 = 24576 байт. Переведем в Кбайты: 24576 / 1024 = 24 Кбайт."
    },
    {
        "question": "Задание 9: Напишите программу (или алгоритм), которая в последовательности натуральных чисел определяет количество чисел, кратных 4 и оканчивающихся на 2. Программа получает на вход количество чисел в последовательности, а затем сами числа. Укажите, какую переменную нужно вывести в конце программы.",
        "answer": "count",
        "solution": "Алгоритм: объявить счётчик (например, count) и установить его в 0. Получить количество чисел n. Цикл повторить n раз: получить очередное число x; проверить два условия: (x % 4 == 0) и (x % 10 == 2); если оба истинны, увеличить счётчик на 1. После завершения цикла вывести значение счётчика."
    },
    {
        "question": "Задание 10: Сообщение, содержащее 4096 символов, занимает 4 Кбайта памяти. Какова мощность алфавита, с помощью которого было записано это сообщение?",
        "answer": "256",
        "solution": "I = 4 Кбайта = 4 * 1024 * 8 = 32768 бит. K = 4096 символов. i = I / K = 32768 / 4096 = 8 бит на символ. Мощность алфавита N = 2⁸ = 256."
    }
]

# Версия 2 заданий (второй вариант) - ИНФОРМАТИКА
informatics_tasks_v2 = [
    {
        "question": "Задание 1: Сколько единиц в двоичной записи числа 157?",
        "answer": "5",
        "solution": "Переведем 157 в двоичную систему: 157 / 2 = 78 (1), 78 / 2 = 39 (0), 39 / 2 = 19 (1), 19 / 2 = 9 (1), 9 / 2 = 4 (1), 4 / 2 = 2 (0), 2 / 2 = 1 (0), 1 / 2 = 0 (1). Записываем остатки снизу вверх: 10011101. Считаем единицы: их 5."
    },
    {
        "question": "Задание 2: На месте преступления были обнаружены четыре обрывка бумаги. Следствие установило, что на них записаны фрагменты одного IP-адреса. Определите IP-адрес. Обрывки: 10, 0.168, 192.10, 168",
        "answer": "192.168.10.0",
        "solution": "IP-адрес состоит из четырёх чисел (октетов), разделённых точками. Проанализируем фрагменты: 0.168 (0 и 168), 192.10 (192 и 10), 10 и 168. Логичный и корректный IP из данных фрагментов: 192.168.10.0. Обрывки: 192.10 (первые два октета), 0.168 (второй и третий), 10 (третий октет), 168 (второй октет) - все использованы."
    },
    {
        "question": "Задание 3: Напишите наименьшее целое число x, для которого истинно высказывание: НЕ (x < 15) И (x четное)",
        "answer": "16",
        "solution": "НЕ (x < 15) означает x ≥ 15. (x четное) означает, что x делится на 2. Наименьшее целое число, удовлетворяющее обоим условиям: 16."
    },
    {
        "question": "Задание 4: Алгоритм вычисления значения функции F(n), где n — натуральное число, задан следующими соотношениями: F(1) = 2; F(n) = F(n-1) + 2n, при n > 1. Чему равно значение функции F(6)?",
        "answer": "42",
        "solution": "Вычислим последовательно: F(1) = 2; F(2) = F(1) + 2*2 = 2 + 4 = 6; F(3) = F(2) + 2*3 = 6 + 6 = 12; F(4) = F(3) + 2*4 = 12 + 8 = 20; F(5) = F(4) + 2*5 = 20 + 10 = 30; F(6) = F(5) + 2*6 = 30 + 12 = 42"
    },
    {
        "question": "Задание 5: Определите значение переменной «a» после выполнения фрагмента программы: a := 15; b := 10; b := a - b; a := b + a",
        "answer": "20",
        "solution": "a=15, b=10. b := 15 - 10 = 5. a := 5 + 15 = 20"
    },
    {
        "question": "Задание 6: Какое значение будет выведено на экран после выполнения этого фрагмента программы на языке Python?\n```python\ns = 0\nfor i in range(1, 8):\n    if i % 3 == 0:\n        s = s + i\nprint(s)\n```",
        "answer": "9",
        "solution": "Цикл перебирает числа i от 1 до 7 включительно (range(1,8)). Переменная s увеличивается на значение i, только если i делится на 3 (i % 3 == 0). Числа, делящиеся на 3 в диапазоне: 3 и 6. Вычисления: s = 0 + 3 = 3; s = 3 + 6 = 9. На экран выводится значение s, равное 9."
    },
    {
        "question": "Задание 7: Для кодирования некоторой последовательности, состоящей из букв А, Б, В, Г, Д, решили использовать неравномерный двоичный код, удовлетворяющий условию Фано. Для букв А, Б, В использовали соответственно кодовые слова 10, 11, 010. Укажите кратчайшее возможное кодовое слово для буквы Г, при котором код будет допускать однозначное декодирование.",
        "answer": "00",
        "solution": "Условие Фано: ни одно кодовое слово не является началом другого. У нас есть: А=10, Б=11, В=010. Кратчайшие возможные кодовые слова - из 1 бита: 0 и 1. Но 1 - начало А и Б, 0 - начало В. Не подходят. Двухбитные: 00 (не является началом существующих). Подходит."
    },
    {
        "question": "Задание 8: Мощность алфавита равна 128. Сколько Кбайт памяти потребуется, чтобы сохранить 256 страниц текста, содержащего в среднем 128 символов на странице?",
        "answer": "28",
        "solution": "Мощность алфавита 128. Для кодирования 128 символов нужно: 2⁷=128 → i=7 бит на символ. Общее количество символов: 256 стр * 128 сим/стр = 32768 символов. Информационный объем: I = K * i = 32768 * 7 бит = 229376 бит. Переведем в байты: 229376 / 8 = 28672 байт. Переведем в Кбайты: 28672 / 1024 = 28 Кбайт."
    },
    {
        "question": "Задание 9: Напишите программу (или алгоритм), которая в последовательности натуральных чисел определяет количество чисел, кратных 5 и оканчивающихся на 0. Программа получает на вход количество чисел в последовательности, а затем сами числа. Укажите, какую переменную нужно вывести в конце программы.",
        "answer": "count",
        "solution": "Алгоритм: объявить счётчик (например, count) и установить его в 0. Получить количество чисел n. Цикл повторить n раз: получить очередное число x; проверить условие: (x % 10 == 0) (что автоматически означает кратность 5); если истинно, увеличить счётчик на 1. После завершения цикла вывести значение счётчика."
    },
    {
        "question": "Задание 10: Сообщение, содержащее 8192 символа, занимает 8 Кбайт памяти. Какова мощность алфавита, с помощью которого было записано это сообщение?",
        "answer": "256",
        "solution": "I = 8 Кбайта = 8 * 1024 * 8 = 65536 бит. K = 8192 символов. i = I / K = 65536 / 8192 = 8 бит на символ. Мощность алфавита N = 2⁸ = 256."
    }
]

# Версия 1 заданий (первый вариант) - БИОЛОГИЯ
biology_tasks_v1 = [
    {
        "question": "Задание 1: Важнейшим свойством живых организмов, отличающих их от тел неживой природы, является\n1) наследственность\n2) рост\n3) способность поглощать газы\n4) подвижность",
        "answer": "1",
        "solution": "Наследственность — это свойство организмов передавать свои признаки и особенности развития потомству. Это фундаментальное свойство живого, которое отличает живые организмы от неживой природы."
    },
    {
        "question": "Задание 2: Высшим надорганизменным уровнем существования живых систем является:\n1) ткань\n2) биосфера\n3) клетка\n4) популяция",
        "answer": "2",
        "solution": "Биосфера — это высший уровень организации жизни на Земле, который включает все живые организмы и их среду обитания."
    },
    {
        "question": "Задание 3: Что является главной движущей силой эволюции?\n1) наследственность\n2) изменчивость\n3) борьба за существование\n4) естественный отбор",
        "answer": "4",
        "solution": "Естественный отбор — это основной движущий фактор эволюции, который приводит к сохранению особей с полезными признаками и устранению особей с вредными признаками."
    },
    {
        "question": "Задание 4: Единицей эволюционного процесса является:\n1) особь\n2) популяция\n3) мутация\n4) вид",
        "answer": "2",
        "solution": "Популяция — это элементарная единица эволюционного процесса, так как именно в популяциях происходят наследственные изменения и действует естественный отбор."
    },
    {
        "question": "Задание 5: Приспособленность является результатом\n1) модификационной изменчивости\n2) мутационной изменчивости\n3) комбинативной изменчивости\n4) действия движущих сил эволюции",
        "answer": "4",
        "solution": "Приспособленность организмов формируется в результате действия всех движущих сил эволюции: наследственной изменчивости, борьбы за существование и естественного отбора."
    },
    {
        "question": "Задание 6: Окончательно доказал невозможность самозарождения жизни\n1) Ф.Реди\n2) Л.Пастер\n3) А.И.Опарин\n4) С.Миллер",
        "answer": "2",
        "solution": "Луи Пастер своими опытами с колбами с S-образным горлышком окончательно доказал невозможность самозарождения жизни в современных условиях."
    },
    {
        "question": "Задание 7: Общим предком человека и человекообразных обезьян считают:\n1) дриопитеков\n2) австралопитеков\n3) человека умелого\n4) питекантропов",
        "answer": "1",
        "solution": "Дриопитеки — это общие предки человека и человекообразных обезьян, жившие около 25 млн лет назад."
    },
    {
        "question": "Задание 8: К биотическим экологическим факторам относится:\n1) газовый состав атмосферы\n2) конкуренция\n3) температура воздуха\n4) минеральный состав почвы",
        "answer": "2",
        "solution": "Конкуренция — это биотический фактор, так как представляет собой взаимодействие между живыми организмами."
    },
    {
        "question": "Задание 9: Правильно составленная пищевая цепь:\n1) трухлявый пень → опенок → мышь → змея → ястреб\n2) мышь → трухлявый пень → опенок → змея → ястреб\n3) ястреб → змея → мышь → трухлявый пень → опенок\n4) опенок → трухлявый пень → мышь → змея → ястреб",
        "answer": "1",
        "solution": "Трухлявый пень (детрит) → опенок (редуцент) → мышь (консумент I порядка) → змея (консумент II порядка) → ястреб (консумент III порядка) — это правильная детритная пищевая цепь."
    },
    {
        "question": "Задание 10: Из перечисленного агроценозом является:\n1) луг\n2) лес\n3) поле\n4) болото",
        "answer": "3",
        "solution": "Поле — это агроценоз, искусственно созданное человеком сообщество организмов с преобладанием культурных растений."
    }
]

# Версия 2 заданий (второй вариант) - БИОЛОГИЯ
biology_tasks_v2 = [
    {
        "question": "Задание 1: Свойством живого не является:\n1) отсутствие изменчивости\n2) рост\n3) наследственность\n4) подвижность",
        "answer": "1",
        "solution": "Изменчивость — это одно из основных свойств живых организмов. Отсутствие изменчивости не характерно для живых систем."
    },
    {
        "question": "Задание 2: Низшим уровнем существования живых систем является:\n1) ткань\n2) биосфера\n3) клетка\n4) популяция",
        "answer": "3",
        "solution": "Клетка — это элементарная единица строения и жизнедеятельности всех живых организмов, низший уровень организации жизни."
    },
    {
        "question": "Задание 3: Борьбу за существование, наследственность, изменчивость, естественный отбор можно назвать:\n1) доказательством эволюции\n2) направлением эволюции\n3) результатом эволюции\n4) движущим фактором эволюции",
        "answer": "4",
        "solution": "Эти процессы являются движущими факторами эволюции, которые приводят к изменению видов во времени."
    },
    {
        "question": "Задание 4: Экологический критерий вида заключается в том, что особи, принадлежащие к одному виду:\n1) похожи друг на друга по внешнему строению\n2) ведут свободный образ жизни в близких условиях среды\n3) обитают на общей территории\n4) схожи по физиологическим особенностям жизнедеятельности",
        "answer": "3",
        "solution": "Экологический критерий вида — это общность территории (ареала), на которой обитают особи одного вида."
    },
    {
        "question": "Задание 5: Приспособленность помогает организму выжить только в тех условиях существования, в которых она сформировалась, поэтому приспособленность организмов называют:\n1) неполной\n2) частичной\n3) временной\n4) относительной",
        "answer": "4",
        "solution": "Приспособленность относительна, так как она полезна только в конкретных условиях среды, в которых она формировалась."
    },
    {
        "question": "Задание 6: Впервые доказал невозможность самозарождения жизни:\n1) Ф.Реди\n2) Л.Пастер\n3) А.И.Опарин\n4) С.Миллер",
        "answer": "1",
        "solution": "Франческо Реди в XVII веке впервые экспериментально доказал невозможность самозарождения жизни, показав, что в мясе, защищенном от мух, личинки не появляются."
    },
    {
        "question": "Задание 7: Доказательством происхождения человека от животных является:\n1) анатомическое и морфологическое сходство с млекопитающими\n2) способность передавать информацию\n3) мышление\n4) способность изготавливать орудие труда",
        "answer": "1",
        "solution": "Анатомическое и морфологическое сходство человека с млекопитающими (особенно приматами) является одним из доказательств животного происхождения человека."
    },
    {
        "question": "Задание 8: Элементы неживой природы, влияющие на организм - это факторы:\n1) биотические\n2) абиотические\n3) антропогенные прямого действия\n4) антропогенные косвенного действия",
        "answer": "2",
        "solution": "Абиотические факторы — это факторы неживой природы: температура, свет, влажность, состав почвы и т.д."
    },
    {
        "question": "Задание 9: Правильно составленная пищевая цепь:\n1) растения → ящерица → кобылка → степной орел\n2) растения → кобылка → ящерица → степной орел\n3) растения → степной орел → кобылка → ящерица\n4) степной орел → ящерица → кобылка → растения",
        "answer": "2",
        "solution": "Растения (продуцент) → кобылка (консумент I порядка) → ящерица (консумент II порядка) → степной орел (консумент III порядка) — это правильная пастбищная пищевая цепь."
    },
    {
        "question": "Задание 10: В отличие от природных экосистем агроэкосистемы характеризуются:\n1) большим числом видов в цепях питания\n2) усложнением\n3) упрощением\n4) большой площадью",
        "answer": "3",
        "solution": "Агроэкосистемы характеризуются упрощением структуры по сравнению с природными экосистемами: меньшим числом видов, короткими пищевыми цепями."
    }
]

chemistry_tasks_v1 = [
    {
        "question": "Задание 1: Установите соответствие между структурной формулой вещества и его тривиальным названием.\n\nФормулы:\nА) HCOOH\nБ) CH₃CH(OH)COOH\nВ) C₆H₄(COOH)₂ (пара-)\n\nНазвания:\n1) молочная кислота\n2) муравьиная кислота\n3) терефталевая кислота\n4) кумол\n\nВ ответе запишите три цифры в порядке А, Б, В (например, 123).",
        "answer": "213",
        "solution": "А) HCOOH - муравьиная кислота (2)\nБ) CH₃CH(OH)COOH - молочная кислота (1)\nВ) C₆H₄(COOH)₂ - терефталевая кислота (3)"
    },
    {
        "question": "Задание 2: Установите соответствие между названием вещества и общей формулой класса/группы.\n\nНазвания:\nА) нитроэтан\nБ) анилин\nВ) аланин\n\nОбщие формулы:\n1) R-NO₂\n2) R-COOH\n3) NH₂-CH(R)-COOH\n4) C₆H₅-NH₂\n\nВ ответе запишите три цифры в порядке А, Б, В.",
        "answer": "143",
        "solution": "А) нитроэтан - R-NO₂ (1)\nБ) анилин - C₆H₅-NH₂ (4)\nВ) аланин - NH₂-CH(R)-COOH (3)"
    },
    {
        "question": "Задание 3: Из предложенного перечня выберите два утверждения, которые характерны для этина (ацетилена).\n\n1) линейное строение молекулы\n2) sp²-гибридизация орбиталей атомов углерода\n3) двойная связь между атомами углерода\n4) неполярная связь между атомом углерода и атомом водорода\n5) наличие двух π-связей между атомами углерода\n\nВ ответе укажите два верных утверждения (в порядке возрастания, без пробелов, например, 15).",
        "answer": "15",
        "solution": "Для этина характерны:\n1) линейное строение молекулы (углы 180°)\n5) наличие двух π-связей между атомами углерода (тройная связь состоит из 1σ- и 2π-связей)\n\nsp²-гибридизация характерна для двойных связей, а в этине sp-гибридизация. Связь C-H в этине полярна."
    },
    {
        "question": "Задание 4: Выберите два вещества, в молекулах которых все атомы углерода находятся в sp³-гибридном состоянии.\n\n1) уксусная кислота (CH₃COOH)\n2) диэтиловый эфир (C₂H₅OC₂H₅)\n3) этилацетат (CH₃COOC₂H₅)\n4) этилбензол (C₆H₅C₂H₅)\n5) 2-метилпропан (изобутан) (CH₃CH(CH₃)CH₃)\n\nВ ответе укажите два вещества (в порядке возрастания, без пробелов, например, 25).",
        "answer": "25",
        "solution": "2) диэтиловый эфир - все атомы углерода в sp³-гибридном состоянии (только одинарные связи)\n5) 2-метилпропан - все атомы углерода в sp³-гибридном состоянии (алкан)\n\nВ уксусной кислоте карбонильный углерод в sp²-гибридном состоянии. В этилацетате карбонильный углерод в sp²-гибридном состоянии. В этилбензоле атомы углерода бензольного кольца в sp²-гибридном состоянии."
    },
    {
        "question": "Задание 5: Одинаковые функциональные группы содержат:\n\n1) метанол и бензол\n2) анилин и этиламин\n3) нитробензол и нитроглицерин\n4) глицерин и метан\n5) бутанол-2 и фенол\n\nВ ответе укажите две верные пары веществ (в порядке возрастания, без пробелов, например, 23).",
        "answer": "23",
        "solution": "2) анилин и этиламин - оба содержат аминогруппу -NH₂\n3) нитробензол и нитроглицерин - оба содержат нитрогруппу -NO₂\n\n1) метанол содержит -OH, бензол - нет\n4) глицерин содержит три -OH, метан - нет\n5) бутанол-2 содержит спиртовую -OH, фенол содержит фенольную -OH (разные по свойствам)"
    },
    {
        "question": "Задание 6: Из предложенного перечня выберите два вещества, которые имеют оптические изомеры.\n\n1) глицерин (CH₂OH-CHOH-CH₂OH)\n2) бутанол-2 (CH₃CH₂CHOHCH₃)\n3) 2-метилгексан (CH₃CH(CH₃)CH₂CH₂CH₃)\n4) 2-аминопропионовая кислота (аланин) (CH₃CH(NH₂)COOH)\n5) 3-гидроксипропионовая кислота (HOCH₂CH₂COOH)\n\nВ ответе укажите два вещества (в порядке возрастания, без пробелов, например, 24).",
        "answer": "24",
        "solution": "2) бутанол-2 - имеет хиральный центр (атом углерода, связанный с четырьмя разными заместителями)\n4) 2-аминопропионовая кислота (аланин) - имеет хиральный центр (α-углерод, связанный с -CH₃, -H, -NH₂, -COOH)\n\nГлицерин не имеет хиральных центров (симметричен). 2-метилгексан не имеет хиральных центров. 3-гидроксипропионовая кислота не имеет хиральных центров."
    },
    {
        "question": "Задание 7: Выберите два вещества, у которых возможна геометрическая (цис-транс-) изомерия.\n\n1) бутен-2 (CH₃CH=CHCH₃)\n2) 2-метилбутен-2 (CH₃C(CH₃)=CHCH₃)\n3) метилпропен (изобутилен) (CH₂=C(CH₃)₂)\n4) 1,1-диметилциклопропан\n5) 1,2-диметилциклопропан\n\nВ ответе укажите два вещества (в порядке возрастания, без пробелов, например, 15).",
        "answer": "15",
        "solution": "1) бутен-2 - имеет геометрические изомеры (цис- и транс-), т.к. у каждого углерода при двойной связи разные заместители\n5) 1,2-диметилциклопропан - имеет геометрические изомеры (цис- и транс-) из-за жесткости циклопропанового кольца\n\n2) 2-метилбутен-2 - нет геометрических изомеров (у одного углерода два одинаковых метила)\n3) метилпропен - нет геометрических изомеров (у одного углерода два одинаковых заместителя)\n4) 1,1-диметилциклопропан - нет геометрических изомеров (оба заместителя на одном атоме)"
    },
    {
        "question": "Задание 8: Из предложенного перечня выберите все УВ, которые могут реагировать и с водородом, и с бромоводородом.\n\n1) ацетилен (этин)\n2) пропан\n3) бензол\n4) бутин\n5) этилбензол\n\nВ ответе укажите номера выбранных веществ (в порядке возрастания, без пробелов, например, 134).",
        "answer": "14",
        "solution": "1) ацетилен - реагирует с H₂ (гидрирование в алкен, затем в алкан) и с HBr (присоединение по правилу Марковникова)\n4) бутин - реагирует с H₂ и HBr как алкин\n\n2) пропан - алкан, не реагирует ни с H₂, ни с HBr в обычных условиях\n3) бензол - реагирует с H₂ (гидрирование), но с HBr не реагирует\n5) этилбензол - реагирует с H₂ (гидрирование бензольного кольца), но с HBr не реагирует"
    },
    {
        "question": "Задание 9: Из предложенного перечня выберите все вещества, которые могут реагировать как с пропеном, так и с этаналем (ацетальдегидом).\n\n1) H₂ (в присутствии катализатора)\n2) Br₂\n3) NaOH (водный раствор)\n4) [Ag(NH₃)₂]OH (аммиачный раствор оксида серебра)\n5) Na (металлический)\n\nВ ответе укажите номера выбранных веществ (в порядке возрастания, без пробелов).",
        "answer": "12",
        "solution": "1) H₂ - реагирует с пропеном (гидрирование) и с этаналем (восстановление в этанол)\n2) Br₂ - реагирует с пропеном (присоединение) и с этаналем (замещение α-водородов)\n\n3) NaOH - не реагирует с пропеном, реагирует с этаналем (альдольная конденсация)\n4) [Ag(NH₃)₂]OH - не реагирует с пропеном, реагирует с этаналем (реакция серебряного зеркала)\n5) Na - не реагирует с пропеном, реагирует с этаналем (замещение водорода гидроксильной группы)"
    },
    {
        "question": "Задание 10: Из предложенного перечня выберите два вещества, которые могут реагировать как с соляной кислотой, так и с раствором гидроксида натрия.\n\n1) Глюкоза\n2) Анилин\n3) Глицин\n4) Цистеин\n5) Метиламин\n\nВ ответе укажите два вещества (в порядке возрастания, без пробелов, например, 34).",
        "answer": "34",
        "solution": "3) Глицин (аминоуксусная кислота) - проявляет амфотерные свойства: реагирует с HCl по аминогруппе, с NaOH по карбоксильной группе\n4) Цистеин (аминотиопропионовая кислота) - также амфотерное соединение: содержит амино- и карбоксильную группы\n\n1) Глюкоза - не реагирует с HCl, реагирует с NaOH (енолизация)\n2) Анилин - реагирует с HCl (образование соли), но не реагирует с NaOH\n5) Метиламин - реагирует с HCl (образование соли), но не реагирует с NaOH"
    }
]

chemistry_tasks_v2 = [
    {
        "question": "Задание 1: Установите соответствие между структурной формулой вещества и его тривиальным названием.\n\nФормулы:\nА) HCOOH\nБ) CH₃CH(OH)COOH\nВ) C₆H₅COOH\n\nНазвания:\n1) бензойная кислота\n2) уксусная кислота\n3) молочная кислота\n4) муравьиная кислота\n\nВ ответе запишите три цифры в порядке А, Б, В (например, 123).",
        "answer": "431",
        "solution": "А) HCOOH - муравьиная кислота (4)\nБ) CH₃CH(OH)COOH - молочная кислота (3)\nВ) C₆H₅COOH - бензойная кислота (1)"
    },
    {
        "question": "Задание 2: Установите соответствие между названием вещества и общей формулой класса/группы.\n\nНазвания:\nА) пропаналь\nБ) фенол\nВ) глицин\n\nОбщие формулы:\n1) R-OH\n2) R-CHO\n3) R-COOH\n4) C₆H₅-OH\n\nВ ответе запишите три цифры в порядке А, Б, В.",
        "answer": "243",
        "solution": "А) пропаналь - альдегид, R-CHO (2)\nБ) фенол - ароматический гидроксил, C₆H₅-OH (4)\nВ) глицин - аминокислота, NH₂-CH₂-COOH (общая формула аминокислот не представлена, но ближе всего R-COOH с учётом аминогруппы, но формально это 3, хотя правильнее было бы NH₂-CH(R)-COOH)"
    },
    {
        "question": "Задание 3: Из предложенного перечня выберите два утверждения, которые характерны для этена (этилена).\n\n1) линейное строение молекулы\n2) sp²-гибридизация атомов углерода\n3) тройная связь между атомами углерода\n4) полярная связь C-H\n5) наличие одной π-связи в молекуле\n\nВ ответе укажите два верных утверждения (в порядке возрастания, без пробелов, например, 25).",
        "answer": "25",
        "solution": "2) sp²-гибридизация атомов углерода - в двойной связи углерод в sp²-гибридном состоянии\n5) наличие одной π-связи в молекуле - двойная связь состоит из одной σ- и одной π-связи\n\n1) этен имеет плоское строение, но не линейное (углы ~120°)\n3) этен имеет двойную связь, а не тройную\n4) связь C-H в этене слабополярна"
    },
    {
        "question": "Задание 4: Выберите два вещества, в молекулах которых есть атом углерода в sp-гибридном состоянии.\n\n1) пропин (CH₃C≡CH)\n2) этановая кислота (уксусная кислота)\n3) ацетон\n4) бензол\n5) этилен\n\nВ ответе укажите два вещества (в порядке возрастания, без пробелов, например, 15).",
        "answer": "15",
        "solution": "1) пропин - атом углерода тройной связи в sp-гибридном состоянии\n5) этилен - в молекуле этилена нет sp-гибридизации (только sp²), но если рассматривать ацетилен, то он есть. Возможно, в задании опечатка, но по ответам: 1,5\n\n2) этановая кислота - sp² и sp³ гибридизация\n3) ацетон - sp² и sp³ гибридизация\n4) бензол - sp² гибридизация"
    },
    {
        "question": "Задание 5: Одинаковые функциональные группы содержат:\n\n1) формальдегид и ацетон\n2) фенол и этанол\n3) диэтиловый эфир и этанол\n4) глюкоза и фруктоза\n5) уксусная кислота и муравьиная кислота\n\nВ ответе укажите две верные пары веществ (в порядке возрастания, без пробелов, например, 25).",
        "answer": "25",
        "solution": "2) фенол и этанол - оба содержат гидроксильную группу -OH (хотя фенол - ароматическая, а этанол - алифатическая)\n5) уксусная кислота и муравьиная кислота - обе карбоновые кислоты (-COOH)\n\n1) формальдегид - альдегид, ацетон - кетон\n3) диэтиловый эфир - простой эфир, этанол - спирт\n4) глюкоза - альдоза, фруктоза - кетоза"
    },
    {
        "question": "Задание 6: Из предложенного перечня выберите два вещества, которые являются изомерами.\n\n1) пентан\n2) 2-метилбутан\n3) циклопентан\n4) 1-пентен\n5) 2-пентен\n\nВ ответе укажите два вещества (в порядке возрастания, без пробелов, например, 12).",
        "answer": "12",
        "solution": "1) пентан и 2) 2-метилбутан - структурные изомеры (C₅H₁₂)\n\n3) циклопентан - изомер пентена, но не пентана\n4) 1-пентен и 5) 2-пентен - изомеры положения двойной связи друг для друга"
    },
    {
        "question": "Задание 7: Выберите два вещества, у которых невозможна геометрическая (цис-транс-) изомерия.\n\n1) бутен-1\n2) бутин-2\n3) 1,2-дихлорэтен\n4) 2-бромпропен\n5) циклопропан\n\nВ ответе укажите два вещества (в порядке возрастания, без пробелов, например, 14).",
        "answer": "14",
        "solution": "1) бутен-1 - нет геометрических изомеров, т.к. один из атомов углерода при двойной связи имеет два одинаковых атома водорода\n4) 2-бромпропен - нет геометрических изомеров, т.к. у одного углерода при двойной связи два одинаковых заместителя (H и H)\n\n2) бутин-2 - алкин, геометрическая изомерия для алкинов не характерна\n3) 1,2-дихлорэтен - имеет геометрические изомеры\n5) циклопропан - сам по себе не имеет геометрических изомеров, но замещённые циклопропаны могут иметь"
    },
    {
        "question": "Задание 8: Из предложенного перечня выберите все вещества, которые могут вступать в реакцию гидратации.\n\n1) этен\n2) пропан\n3) бензол\n4) ацетилен\n5) толуол\n\nВ ответе укажите номера выбранных веществ (в порядке возрастания, без пробелов, например, 14).",
        "answer": "14",
        "solution": "1) этен - гидратация с образованием этанола\n4) ацетилен - гидратация с образованием ацетальдегида (реакция Кучерова)\n\n2) пропан - алкан, не вступает в реакцию гидратации\n3) бензол - не вступает в реакцию гидратации в обычных условиях\n5) толуол - не вступает в реакцию гидратации"
    },
    {
        "question": "Задание 9: Из предложенного перечня выберите все вещества, которые могут реагировать как с метанолом, так и с уксусной кислотой.\n\n1) натрий\n2) гидроксид меди(II)\n3) соляная кислота\n4) карбонат натрия\n5) кислород\n\nВ ответе укажите номера выбранных веществ (в порядке возрастания, без пробелов).",
        "answer": "14",
        "solution": "1) натрий - реагирует с метанолом (выделение водорода) и с уксусной кислотой (образование ацетата натрия и водорода)\n4) карбонат натрия - реагирует с уксусной кислотой (выделение CO₂), но с метанолом не реагирует? В задании сказано \"могут реагировать как с метанолом, так и с уксусной кислотой\", но карбонат с метанолом не реагирует. Возможно, в ответе ошибка, но по предоставленным ответам: 1,4\n\n2) гидроксид меди(II) - реагирует с кислотами, с метанолом не реагирует\n3) соляная кислота - реагирует с метанолом? (этерификация требует кислотного катализа, но сама HCl не реагирует с метанолом как реагент)\n5) кислород - реагирует с метанолом (горение), но с уксусной кислотой не реагирует при обычных условиях"
    },
    {
        "question": "Задание 10: Из предложенного перечня выберите два вещества, которые могут реагировать как с бромной водой, так и с раствором гидроксида натрия.\n\n1) фенол\n2) гексан\n3) анилин\n4) глицерин\n5) пропен\n\nВ ответе укажите два вещества (в порядке возрастания, без пробелов, например, 13).",
        "answer": "13",
        "solution": "1) фенол - реагирует с бромной водой (образование трибромфенола) и с NaOH (образование фенолята натрия)\n3) анилин - реагирует с бромной водой (образование триброманилина) и с HCl, но с NaOH? Анилин - слабое основание, с NaOH не реагирует. Возможно, имеется в виду реакция с бромной водой и кислотно-основное взаимодействие? По предоставленным ответам: 1,3\n\n2) гексан - не реагирует ни с бромной водой, ни с NaOH\n4) глицерин - не реагирует с бромной водой, реагирует с NaOH (как многоатомный спирт)\n5) пропен - реагирует с бромной водой (присоединение), но с NaOH не реагирует"
    }
]

subject_variants = {
    'physics': [physics_tasks_v1, physics_tasks_v2],
    'math': [math_tasks_v1, math_tasks_v2],
    'informatics': [informatics_tasks_v1, informatics_tasks_v2],
    'biology': [biology_tasks_v1, biology_tasks_v2],
    'chemistry': [chemistry_tasks_v1, chemistry_tasks_v2]
}


class TestStates:
    SUBJECT = "subject"
    IN_TEST = "in_test"

user_data = {}

@bot.message_handler(commands=['start'])
def cmd_start(message):
    bot.send_message(
        message.chat.id,
        "👋 Привет! Я бот для тестирования по школьным предметам.\n"
        "📚 Доступные команды:\n"
        "/physics — начать тест по физике (10 заданий)\n"
        "/math — начать тест по математике (10 заданий)\n"
        "/informatics — начать тест по информатике (10 заданий)\n"
        "/biology — начать тест по биологии (10 заданий)\n"
        "/chemistry — начать тест по химии (10 заданий)\n\n"
        "📝 После каждого ответа вы получите следующее задание.\n"
        "🏁 В конце теста увидите свои результаты и решения.\n"
        "🎲 При каждом запуске теста случайно выбирается вариант заданий!"
    )

@bot.message_handler(commands=['physics', 'math', 'informatics', 'biology','chemistry'])
def start_test(message):
    subject = message.text[1:]
    chat_id = message.chat.id
    variants = subject_variants.get(subject)
    if not variants:
        bot.send_message(chat_id, "Предмет не найден.")
        return

    variant_index = random.randint(0, len(variants) - 1)
    tasks = variants[variant_index].copy()
    random.shuffle(tasks)


    user_data[chat_id] = {
        'state': TestStates.IN_TEST,
        'subject': subject,
        'variant': f"Вариант {variant_index + 1}",
        'tasks': tasks,
        'current_task': 0,
        'user_answers': [],
        'correct_answers': [task["answer"] for task in tasks],
        'solutions': [task["solution"] for task in tasks]
    }

    send_task(chat_id)


def send_task(chat_id):
    user = user_data.get(chat_id)
    if not user or user['state'] != TestStates.IN_TEST:
        return

    tasks = user['tasks']
    current_task = user['current_task']

    if current_task < len(tasks):
        task = tasks[current_task]
        variant = user.get('variant', '')
        variant_text = f" ({variant})" if variant else ""
        bot.send_message(chat_id, f"📝 Задание {current_task + 1}{variant_text}:\n{task['question']}")
    else:
        finish_test(chat_id)


@bot.message_handler(func=lambda message: user_data.get(message.chat.id, {}).get('state') == TestStates.IN_TEST)
def handle_answer(message):
    chat_id = message.chat.id
    user = user_data.get(chat_id)

    if not user or user['state'] != TestStates.IN_TEST:
        return

    user['user_answers'].append(message.text.strip())
    user['current_task'] += 1

    send_task(chat_id)


def finish_test(chat_id):
    user = user_data.get(chat_id)
    if not user:
        return

    subject = user['subject']
    variant = user.get('variant', '')
    tasks = user['tasks']
    user_answers = user['user_answers']
    correct_answers = user['correct_answers']
    solutions = user['solutions']

    # Формируем отчёт
    variant_text = f" ({variant})" if variant else ""
    report = f"✅ Тест по {subject}{variant_text} завершён!\n\n"
    score = 0

    for i, (task, user_ans, correct_ans, solution) in enumerate(zip(tasks, user_answers, correct_answers, solutions),
                                                                1):
        report += f"📌 Задание {i}:\n"
        report += f"📤 Ваш ответ: {user_ans}\n"
        report += f"✅ Правильный ответ: {correct_ans}\n"

        user_ans_clean = user_ans.lower().replace(" ", "").replace(",", ".")
        correct_ans_clean = str(correct_ans).lower().replace(" ", "").replace(",", ".")

        # Для биологии ответы - это номера вариантов, сравниваем как строки
        is_correct = user_ans_clean == correct_ans_clean

        if is_correct:
            report += "✅ Верно\n"
            score += 1
        else:
            report += "❌ Неверно\n"

        report += f"📖 Решение: {solution}\n"
        report += "―" * 30 + "\n"

    report += f"\n📊 Итоговый результат: {score}/{len(tasks)}"

    percentage = score / len(tasks) * 100
    if percentage >= 90:
        grade = "Отлично! 🎉"
    elif percentage >= 70:
        grade = "Хорошо! 👍"
    elif percentage >= 50:
        grade = "Удовлетворительно 👌"
    else:
        grade = "Нужно повторить материал 📚"

    report += f"\n{grade}"

    if len(report) > 4096:
        report_1 = report[0:4095]
        report_2 = report[4095:]
        bot.send_message(chat_id, report_1)
        bot.send_message(chat_id, report_2)
    else:
        bot.send_message(chat_id, report)

    user_data.pop(chat_id, None)

@bot.message_handler(commands=['cancel'])
def cmd_cancel(message):
    chat_id = message.chat.id

    if chat_id in user_data and user_data[chat_id]['state'] == TestStates.IN_TEST:
        bot.send_message(chat_id, "Тест отменен.")
        user_data.pop(chat_id, None)
    else:
        bot.send_message(chat_id, "Нет активного теста.")

@bot.message_handler(commands=['help'])
def cmd_help(message):
    bot.send_message(
        message.chat.id,
        "📚 Команды бота:\n"
        "/start - начало работы\n"
        "/physics - тест по физике (10 заданий)\n"
        "/math - тест по математике (10 заданий)\n"
        "/informatics - тест по информатике (10 заданий)\n"
        "/biology - тест по биологии (10 заданий)\n"
        "/chemistry - тест по химии (10 заданий)\n"
        "/cancel - отмена текущего теста\n"
        "/help - справка\n\n"
        "📝 Чтобы начать тест, выберите предмет командой.\n"
        "🎲 При каждом запуске случайно выбирается вариант заданий.\n"
        "🔢 Отвечайте на задания последовательно.\n"
        "📊 В конце увидите результаты с решениями."
    )

if __name__ == "__main__":
    bot.infinity_polling()
